<script type="text/x-red" data-template-name="my-custom-node">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name">
  </div>
</script>

<script type="text/x-red" data-help-name="my-custom-node">
  <p>Custom node with sidebar to export nodes to JSON and create a test flow.</p>
</script>

<script type="text/javascript">
  RED.sidebar.addTab({
    id: "my-custom-node-sidebar",
    label: "My Custom Node",
    name: "my-custom-node",
    content: `
      <div>
        <button id="export-button">Export Nodes to JSON</button>
        <pre id="exported-json"></pre>
        <button id="create-test-flow">Create Test Flow</button>
      </div>
    `
  });

  // Add event listener to the export button
  $('#export-button').on('click', function() {
    var nodes = RED.nodes.getNodeList();
    var json = JSON.stringify(nodes, null, 2);
    $('#exported-json').text(json);
  });

  // Add event listener to the create test flow button
  $('#create-test-flow').on('click', function() {
    // Create a trigger node
    var triggerNode = {
      id: RED.nodes.id(),
      type: "inject",
      name: "Test Trigger",
      topic: "",
      payload: "",
      payloadType: "date",
      repeat: "",
      crontab: "",
      once: false,
      onceDelay: 0.1,
      x: 100,
      y: 100,
      wires: [[]]
    };

    // Create a debug node
    var debugNode = {
      id: RED.nodes.id(),
      type: "debug",
      name: "Test Debug",
      active: true,
      tosidebar: true,
      console: false,
      tostatus: false,
      complete: "false",
      targetType: "full",
      x: 300,
      y: 100,
      wires: []
    };

    // Wire the trigger node to the debug node
    triggerNode.wires[0].push(debugNode.id);

    // Add the nodes to the current flow
    RED.nodes.add(triggerNode);
    RED.nodes.add(debugNode);

    // Deploy the changes
    RED.nodes.dirty(true);
    RED.view.redraw();
  });
</script>
