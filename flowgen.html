<script type="text/javascript">
(function() {
    RED.plugins.registerPlugin("flowgen", {
        onadd: function() {


            var content = $("<div>").css({"position":"relative","height":"100%"});
            content.className = "red-ui-flowgen"

            $("<div>My Example Sidebar</div>").appendTo(content);
            var addButton = $("<button>Add Debug Node</button>").css({"margin":"10px"}).appendTo(content);
            var fetchFlowsButton = $("<button>Fetch Flows</button>").css({"margin":"10px"}).appendTo(content);
            var flowsDisplay = $("<pre>").css({"overflow-y": "scroll", "height": "300px", "background-color": "#f5f5f5", "padding": "10px"}).appendTo(content);
            var fetchCurrentFlowButton = $("<button>Fetch Current Flow</button>").css({"margin":"10px"}).appendTo(content);
            var currentFlowDisplay = $("<pre>").css({"overflow-y": "scroll", "height": "300px", "background-color": "#f5f5f5", "padding": "10px"}).appendTo(content);
            addButton.click(function() {
                console.log('x')
                var newNode = {
                    id: RED.nodes.id(),
                    type: "debug",
                    name: "Debug Node",
                    z: RED.workspaces.active(),
                    _def: { _: "flowgen" },
                    x: 50,
                    y: 50
                };
                console.log('y')
                console.log(RED.nodes)
                RED.nodes.add(newNode);
                console.log('z')
                RED.view.redraw();
                console.log('z1')
            });
            fetchFlowsButton.click(function() {
                $.get("/flows", function(data) {
                    flowsDisplay.text(JSON.stringify(data, null, 2));
                });
            });
            fetchCurrentFlowButton.click(function() {
                var currentFlowId = RED.workspaces.active();
                $.get("/flow/" + currentFlowId, function(data) {
                    currentFlowDisplay.text(JSON.stringify(data, null, 2));
                });
            });


            // Register an action so the user could bind a keyboard shortcut to show
            // the sidebar.
            RED.actions.add("core:show-example-sidebar-tab",function() {
                RED.sidebar.show("flowgen")
            });
            RED.sidebar.addTab({
                id: "flowgen",
                name: "Example Sidebar", // long name for the menu
                label: "Example", // short name for the tab
                iconClass: "fa fa-birthday-cake", //pick from https://fontawesome.com/v4.7.0/icons/
                content: content,
                action: "core:show-example-sidebar-tab"
            });
        }
    })
})();
</script>
            // To determine the ID of the current flow being displayed in the editor
            var currentFlowId = RED.workspaces.active();
            console.log("Current Flow ID: ", currentFlowId);
